---
title: Grafana
description: 메트릭 시각화 및 대시보드 플랫폼
---

Grafana는 다양한 데이터 소스로부터 메트릭을 시각화하고 분석할 수 있는 오픈소스 플랫폼입니다.

## 주요 특징

- **다양한 데이터 소스**: Prometheus, InfluxDB, Elasticsearch 등
- **대시보드**: 드래그 앤 드롭으로 대시보드 구성
- **알림**: 조건 기반 알림 설정
- **플러그인**: 확장 가능한 플러그인 시스템
- **공유**: 대시보드 공유 및 임베딩

## Docker로 설치

```yaml
# docker-compose.yml
version: '3'

services:
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_USERS_ALLOW_SIGN_UP=false
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning
    depends_on:
      - prometheus

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus

volumes:
  grafana-data:
  prometheus-data:
```

## 데이터 소스 자동 설정

```yaml
# grafana/provisioning/datasources/prometheus.yml
apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: true
```

## 대시보드 자동 설정

```yaml
# grafana/provisioning/dashboards/dashboard.yml
apiVersion: 1

providers:
  - name: 'Default'
    orgId: 1
    folder: ''
    type: file
    disableDeletion: false
    updateIntervalSeconds: 10
    allowUiUpdates: true
    options:
      path: /etc/grafana/provisioning/dashboards
```

## 대시보드 JSON 예제

```json
{
  "dashboard": {
    "title": "Application Metrics",
    "panels": [
      {
        "id": 1,
        "title": "HTTP Request Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{route}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 0
        }
      },
      {
        "id": 2,
        "title": "Response Time",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m])",
            "legendFormat": "Average Response Time"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 0
        }
      }
    ]
  }
}
```

## 유용한 쿼리 패널

### CPU 사용률

```promql
100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
```

### 메모리 사용률

```promql
(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100
```

### 디스크 I/O

```promql
# Read
rate(node_disk_read_bytes_total[5m])

# Write
rate(node_disk_written_bytes_total[5m])
```

### 네트워크 트래픽

```promql
# Receive
rate(node_network_receive_bytes_total[5m])

# Transmit
rate(node_network_transmit_bytes_total[5m])
```

### HTTP 에러율

```promql
sum(rate(http_requests_total{status=~"5.."}[5m])) / sum(rate(http_requests_total[5m])) * 100
```

## 알림 설정

```yaml
# Notification Channel (Slack)
apiVersion: 1

notifiers:
  - name: Slack Alerts
    type: slack
    uid: slack
    org_id: 1
    is_default: true
    settings:
      url: https://hooks.slack.com/services/YOUR/WEBHOOK/URL
      recipient: '#alerts'
      username: Grafana
```

## Terraform으로 대시보드 관리

```hcl
resource "grafana_dashboard" "metrics" {
  config_json = file("dashboards/metrics.json")
}

resource "grafana_alert_notification" "slack" {
  name = "Slack Notifications"
  type = "slack"
  
  settings = {
    url        = var.slack_webhook_url
    recipient  = "#alerts"
    uploadImage = true
  }
}

resource "grafana_alert" "high_cpu" {
  name    = "High CPU Usage"
  message = "CPU usage is above 80%"
  
  rule {
    name      = "CPU > 80%"
    condition = "A"
    
    query {
      model = jsonencode({
        expr = "avg(node_cpu_usage) > 80"
      })
    }
  }
  
  notification = [grafana_alert_notification.slack.id]
}
```

## 변수 사용

```json
{
  "templating": {
    "list": [
      {
        "name": "instance",
        "type": "query",
        "datasource": "Prometheus",
        "query": "label_values(node_cpu_seconds_total, instance)",
        "multi": true,
        "includeAll": true
      },
      {
        "name": "interval",
        "type": "interval",
        "options": [
          {"text": "1m", "value": "1m"},
          {"text": "5m", "value": "5m"},
          {"text": "10m", "value": "10m"},
          {"text": "30m", "value": "30m"},
          {"text": "1h", "value": "1h"}
        ],
        "current": {
          "text": "5m",
          "value": "5m"
        }
      }
    ]
  }
}
```

## 대시보드 패널 타입

### Graph (시계열)
```json
{
  "type": "graph",
  "title": "시계열 그래프",
  "targets": [
    {
      "expr": "rate(http_requests_total[5m])"
    }
  ]
}
```

### Stat (단일 값)
```json
{
  "type": "stat",
  "title": "현재 값",
  "targets": [
    {
      "expr": "sum(up)"
    }
  ],
  "options": {
    "colorMode": "value",
    "graphMode": "none"
  }
}
```

### Gauge (게이지)
```json
{
  "type": "gauge",
  "title": "CPU 사용률",
  "targets": [
    {
      "expr": "avg(node_cpu_usage)"
    }
  ],
  "options": {
    "showThresholdMarkers": true
  },
  "fieldConfig": {
    "defaults": {
      "thresholds": {
        "steps": [
          {"value": 0, "color": "green"},
          {"value": 60, "color": "yellow"},
          {"value": 80, "color": "red"}
        ]
      }
    }
  }
}
```

### Table (테이블)
```json
{
  "type": "table",
  "title": "인스턴스 상태",
  "targets": [
    {
      "expr": "up",
      "format": "table"
    }
  ]
}
```

## Loki를 사용한 로그 조회

```promql
# 특정 레이블의 로그
{job="myapp"} |= "error"

# JSON 파싱
{job="myapp"} | json | level="error"

# 로그 속도
rate({job="myapp"}[5m])

# 에러 로그 카운트
sum by (level) (count_over_time({job="myapp"} |= "error" [5m]))
```

## Kubernetes 모니터링 대시보드

```yaml
# Prometheus + Grafana로 K8s 모니터링
- Pod CPU/Memory 사용량
- Node 리소스 사용량
- Deployment 상태
- PersistentVolume 사용량
- Ingress 트래픽
- 컨테이너 재시작 횟수
```

## 언제 사용하나요?

- 시스템 메트릭 시각화
- 애플리케이션 성능 모니터링
- 비즈니스 메트릭 대시보드
- 로그 분석
- 실시간 알림

## 추가 자료

- [공식 문서](https://grafana.com/docs/)
- [대시보드 갤러리](https://grafana.com/grafana/dashboards/)

